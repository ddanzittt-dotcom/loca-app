*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{
--pri:#C9686E;--pri-lt:#F7ECEC;--pri-md:#E8A0A3;
--sec:#6BA08F;--sec-lt:#EAF4F1;
--acc:#F0C060;--acc-lt:#FEF7E5;
--bg:#F8F5F2;--srf:#FFFFFF;--srf2:#FDFCFB;
--bdr:#EDE9E5;--bdr2:#D9D4CF;
--txt:#2C2925;--txt2:#5C5652;--mut:#9C9590;
--danger:#C9686E;--success:#6BA08F;--warn:#E8A850;
--safe-t:env(safe-area-inset-top,0px);--safe-b:env(safe-area-inset-bottom,0px);
}
html,body{height:100%;overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);color:var(--txt)}
input,textarea,select,button{font-family:inherit}
.leaflet-control-attribution{font-size:9px!important;opacity:.5}
.leaflet-control-zoom{border:none!important;box-shadow:0 6px 20px rgba(0,0,0,.12)!important;border-radius:14px!important;overflow:hidden}
.leaflet-control-zoom a{width:38px!important;height:38px!important;line-height:38px!important;font-size:18px!important;border:none!important;background:rgba(255,255,255,.95)!important;backdrop-filter:blur(10px)}
#app{position:fixed;inset:0;display:flex;flex-direction:column}
#topbar{height:54px;display:flex;align-items:center;padding:0 12px;gap:6px;z-index:3000;flex-shrink:0;background:transparent;transition:background .2s}
#topbar.solid{background:var(--srf);border-bottom:1px solid var(--bdr)}
.logo{font-size:19px;font-weight:900;letter-spacing:-.5px;color:var(--pri);flex-shrink:0}.logo span{color:var(--sec)}
#map-sel-btn{flex:1;display:flex;align-items:center;gap:6px;padding:9px 12px;border-radius:14px;border:1px solid var(--bdr);background:rgba(255,255,255,.93);backdrop-filter:blur(10px);cursor:pointer;box-shadow:0 6px 16px rgba(0,0,0,.07);min-width:0}
#map-sel-btn .dot{width:10px;height:10px;border-radius:5px;flex-shrink:0}
#map-sel-btn .t{font-size:13px;font-weight:800;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}
#map-sel-btn .arr{margin-left:auto;font-size:11px;color:var(--mut);flex-shrink:0}
.icon-btn{height:36px;border-radius:12px;border:1px solid var(--bdr);background:rgba(255,255,255,.93);cursor:pointer;font-size:11px;font-weight:900;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(0,0,0,.06);flex-shrink:0;padding:0 8px}
#content{flex:1;position:relative;overflow:hidden}
#tabbar{height:72px;padding-bottom:var(--safe-b);background:rgba(255,255,255,.95);backdrop-filter:blur(14px);border-top:1px solid var(--bdr);display:flex;justify-content:space-around;align-items:flex-start;padding-top:6px;z-index:2500;flex-shrink:0}
.tab-btn{background:none;border:none;cursor:pointer;padding:5px 14px;display:flex;flex-direction:column;align-items:center;gap:1px;min-width:60px}
.tab-btn .ic{font-size:21px;transition:opacity .15s}.tab-btn .lb{font-size:10px;font-weight:600;color:var(--mut);transition:color .15s}
.tab-btn.on .ic{opacity:1}.tab-btn:not(.on) .ic{opacity:.5;filter:grayscale(.6)}
.tab-btn.on .lb{font-weight:800;color:var(--pri)}
.tab-btn .ind{width:4px;height:4px;border-radius:2px;background:var(--pri);margin-top:2px;opacity:0;transition:opacity .15s}.tab-btn.on .ind{opacity:1}
.screen{position:absolute;inset:0;display:none;flex-direction:column}.screen.active{display:flex}
#map-container{position:absolute;inset:0}
#map{width:100%;height:100%}
#map.cursor-pin{cursor:crosshair}#map.cursor-line{cursor:crosshair}#map.cursor-poly{cursor:crosshair}
.map-search{position:absolute;top:10px;left:10px;right:10px;z-index:2000}
.search-box{display:flex;gap:6px;align-items:center;background:rgba(255,255,255,.93);backdrop-filter:blur(10px);border:1px solid var(--bdr);border-radius:16px;padding:9px 12px;box-shadow:0 8px 22px rgba(0,0,0,.09)}
.search-box input{flex:1;border:none;background:transparent;outline:none;font-size:13px;color:var(--txt);font-weight:700}
.search-results{margin-top:6px;background:rgba(255,255,255,.98);border:1px solid var(--bdr);border-radius:16px;overflow:hidden;box-shadow:0 14px 30px rgba(0,0,0,.11);max-height:240px;overflow-y:auto;display:none}
.search-results.open{display:block}
.sr-item{padding:10px 12px;cursor:pointer;border-top:1px solid var(--bdr)}.sr-item:first-child{border-top:none}
.sr-item .n{font-size:12px;font-weight:900}.sr-item .a{font-size:10px;color:var(--mut);margin-top:2px}
.draw-pill{position:absolute;top:62px;left:50%;transform:translateX(-50%);z-index:2100;color:#fff;padding:7px 14px;border-radius:999px;font-size:11px;font-weight:900;box-shadow:0 8px 24px rgba(0,0,0,.15);display:none}.draw-pill.on{display:block}
.draw-ctrl{position:absolute;bottom:100px;left:10px;right:10px;z-index:2200;display:none;gap:6px}.draw-ctrl.on{display:flex}
.fab-col{position:absolute;right:12px;bottom:14px;z-index:2100;display:flex;flex-direction:column;gap:6px}
.fab{width:48px;height:auto;border-radius:16px;border:1px solid var(--bdr);background:rgba(255,255,255,.93);cursor:pointer;font-size:18px;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 8px 22px rgba(0,0,0,.09);transition:all .15s;padding:8px 4px;gap:2px}
.fab .fab-label{font-size:8px;font-weight:900;color:var(--txt2);white-space:nowrap}
.fab.active{border-color:var(--pri);background:var(--pri-lt)}.fab.active .fab-label{color:var(--pri)}
.stats-pill{position:absolute;left:10px;bottom:14px;z-index:2100;background:rgba(255,255,255,.92);border:1px solid var(--bdr);border-radius:16px;padding:9px 12px;box-shadow:0 8px 22px rgba(0,0,0,.09);max-width:260px}
.stats-pill .t{font-size:11px;font-weight:900}.stats-pill .s{font-size:10px;color:var(--mut);font-weight:700;margin-top:2px}
.filter-bar{position:absolute;left:10px;bottom:80px;z-index:2100;background:rgba(255,255,255,.92);border:1px solid var(--bdr);border-radius:16px;padding:8px 12px;box-shadow:0 8px 22px rgba(0,0,0,.07)}
.filter-bar.open{right:72px}.filter-bar:not(.open){right:auto}
.filter-bar .fl{font-size:11px;font-weight:900;color:var(--txt2)}
.chip{border:1px solid var(--bdr);background:#fff;color:var(--txt2);border-radius:999px;padding:5px 9px;font-size:10px;font-weight:900;cursor:pointer;white-space:nowrap;transition:all .12s}
.chip.on{border-color:var(--pri);background:var(--pri-lt);color:var(--pri)}
.overlay{position:fixed;inset:0;z-index:5000;display:none}.overlay.open{display:block}
.overlay .bg{position:absolute;inset:0;background:rgba(0,0,0,.28);backdrop-filter:blur(2px)}
.sheet{position:absolute;left:0;right:0;bottom:0;background:var(--srf);border-radius:22px 22px 0 0;box-shadow:0 -18px 50px rgba(0,0,0,.2);overflow-y:auto;max-height:85vh;transform:translateY(100%);transition:transform .25s cubic-bezier(.32,.72,.32,1)}
.overlay.open .sheet{transform:translateY(0)}
.sheet .handle{display:flex;justify-content:center;padding:10px 0 6px}.sheet .handle div{width:40px;height:4px;border-radius:2px;background:var(--bdr2)}
.sheet-body{padding:2px 16px 20px}
.list-scroll{flex:1;overflow-y:auto;padding:0 14px 16px}
.f-card{background:var(--srf);border:1px solid var(--bdr);border-radius:16px;padding:11px 12px;display:flex;gap:10px;align-items:center;margin-bottom:8px;cursor:pointer;transition:box-shadow .12s}
.f-card:active{box-shadow:0 4px 16px rgba(0,0,0,.08)}
.f-card .icon{width:42px;height:42px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:19px;flex-shrink:0}
.f-card .info{flex:1;min-width:0}.f-card .info .n{font-size:13px;font-weight:900;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}
.f-card .info .meta{font-size:10px;color:var(--mut);margin-top:2px;font-weight:700}
.f-card .right{text-align:right;flex-shrink:0}.f-card .right .d{font-size:10px;color:var(--mut);font-weight:800}
.f-card .right .lc{font-size:9px;color:var(--sec);font-weight:900;margin-top:2px}
.page-scroll{position:absolute;inset:0;overflow-y:auto;padding:14px}
.page-title{font-size:19px;font-weight:900}.page-sub{font-size:11px;color:var(--mut);font-weight:700;margin-top:4px;line-height:1.5}
.card{background:var(--srf);border:1px solid var(--bdr);border-radius:18px;padding:13px;margin-bottom:10px}
.btn{border:none;padding:11px 14px;border-radius:14px;font-size:12px;font-weight:900;cursor:pointer;transition:opacity .1s}.btn:active{opacity:.8}
.btn-pri{background:var(--pri);color:#fff}.btn-sec{background:var(--sec);color:#fff}
.btn-out{border:1px solid var(--bdr);background:#fff;color:var(--txt2)}
.btn-danger{border:1px solid var(--bdr);background:var(--pri-lt);color:var(--pri)}
.btn-block{width:100%;display:block}
.input{width:100%;border-radius:14px;border:1px solid var(--bdr);padding:11px 12px;font-size:13px;font-weight:700;outline:none;background:#fff}.input:focus{border-color:var(--pri)}
.label{font-size:10px;color:var(--mut);font-weight:900;margin-bottom:5px;display:block}
.gap-8{display:flex;gap:8px}.mt-8{margin-top:8px}.mt-12{margin-top:12px}.mt-14{margin-top:14px}.mt-16{margin-top:16px}
#toasts{position:fixed;top:12px;left:0;right:0;z-index:9999;display:flex;flex-direction:column;align-items:center;gap:6px;pointer-events:none}
.toast{max-width:340px;width:calc(100% - 28px);color:#fff;padding:9px 14px;border-radius:14px;font-size:12px;font-weight:700;box-shadow:0 8px 26px rgba(0,0,0,.16);animation:toastIn .22s ease forwards}
@keyframes toastIn{from{transform:translateY(-8px);opacity:0}to{transform:translateY(0);opacity:1}}
.toast.out{animation:toastOut .2s ease forwards}
@keyframes toastOut{to{transform:translateY(-8px);opacity:0}}
@keyframes bounce{0%{transform:translateY(-30px);opacity:0}60%{transform:translateY(4px);opacity:1}100%{transform:translateY(-8px);opacity:1}}
@keyframes gpsPulse{0%{box-shadow:0 0 0 0 rgba(79,134,198,.4)}70%{box-shadow:0 0 0 12px rgba(79,134,198,0)}100%{box-shadow:0 0 0 0 rgba(79,134,198,0)}}
@keyframes syncPulse{0%,100%{opacity:1}50%{opacity:.4}}
.confirm-overlay{position:fixed;inset:0;z-index:9500;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.35);backdrop-filter:blur(3px)}
.confirm-overlay.open{display:flex}
.confirm-box{background:#fff;border-radius:20px;padding:20px;width:calc(100% - 48px);max-width:320px;box-shadow:0 20px 50px rgba(0,0,0,.25)}
.cat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:7px}
.cat-btn{border-radius:14px;border:1px solid var(--bdr);background:#fff;padding:9px 4px;cursor:pointer;text-align:center;transition:all .12s}
.cat-btn.on{border-color:var(--pri);background:var(--pri-lt)}
.cat-btn .e{font-size:17px}.cat-btn .l{font-size:10px;font-weight:900;margin-top:3px}
.cat-btn.on .l{color:var(--pri)}.cat-btn:not(.on) .l{color:var(--txt2)}
.mood-bar{display:flex;gap:5px;flex-wrap:wrap}
.mood-btn{width:32px;height:32px;border-radius:16px;border:1px solid var(--bdr);background:#fff;cursor:pointer;font-size:15px;display:flex;align-items:center;justify-content:center;transition:all .1s}
.mood-btn.on{border:2px solid var(--pri);background:var(--pri-lt)}
.log-entry{background:var(--srf2);border:1px solid var(--bdr);border-radius:16px;padding:10px 12px;margin-bottom:6px}
.log-entry .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}
.log-entry .top .d{font-size:10px;color:var(--mut);font-weight:900}.log-entry .top .m{font-size:15px}
.log-entry .note{font-size:12px;font-weight:700;line-height:1.5}
/* Role badges */
.role-badge{display:inline-flex;align-items:center;gap:3px;padding:3px 8px;border-radius:999px;font-size:9px;font-weight:900;flex-shrink:0}
.role-owner{background:#FEF7E5;color:#D4960A;border:1px solid #F0C060}
.role-editor{background:var(--sec-lt);color:var(--sec);border:1px solid var(--sec)}
.role-observer{background:#EEF2FF;color:#6366F1;border:1px solid #A5B4FC}
.sync-dot{width:8px;height:8px;border-radius:4px;flex-shrink:0}
.sync-active{background:#22C55E;animation:syncPulse 2s infinite}
.sync-idle{background:#D1D5DB}
.sync-error{background:#EF4444}
.presence-row{display:flex;gap:4px;align-items:center;flex-wrap:wrap}
.presence-chip{display:inline-flex;align-items:center;gap:3px;padding:2px 6px;border-radius:999px;font-size:9px;font-weight:800;background:var(--bg);border:1px solid var(--bdr)}
.observer-banner{background:#EEF2FF;border:1px solid #A5B4FC;border-radius:14px;padding:10px 14px;display:flex;align-items:center;gap:8px;margin-bottom:8px}
.observer-banner .ob-icon{font-size:18px}.observer-banner .ob-text{font-size:11px;font-weight:800;color:#6366F1;line-height:1.4}